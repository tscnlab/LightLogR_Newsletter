<!--
  ☀️ HIGH NOON EDITION BACKGROUND ☀️
  ▸ Blue sky with drifting clouds and a sun that arcs across the page.
  ▸ Gentle sky gradient from deeper blue overhead to lighter blue near the horizon.
-->

<style>
:root {
  --sky-top: #1f6ed4;
  --sky-mid: #4ea2f5;
  --sky-low: #9ad9ff;
  --doc-h: 100vh;
}

html, body {
  height: auto !important;
  min-height: 100vh;
}

.page-columns,
.page-columns > *,
.quarto-grid,
.quarto-article {
  background: transparent !important;
}

body {
  margin: 0;
  position: relative;
  color: #0b2239;
  transition: color 0.35s ease-out;
}

body a { color: #0b2239; }

#sky-layer {
  position: absolute;
  inset: 0;
  min-height: var(--doc-h);
  z-index: -3;
  background: linear-gradient(
      to bottom,
      var(--sky-top) 0%,
      var(--sky-mid) 45%,
      var(--sky-low) 100%
  );
  background-repeat: no-repeat;
  background-size: 100% 100%;
}

#sun-group {
  position: absolute;
  top: 10vh;
  left: -10vw;
  z-index: -2;
  pointer-events: none;
}

#sun {
  position: relative;
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: radial-gradient(circle at 50% 50%, #ffffff 0%, #fff6c9 30%, rgba(255, 236, 170, 0.28) 58%, rgba(255, 236, 170, 0) 125%);
  box-shadow: 0 0 100px rgba(255, 248, 210, 0.75);
}

#sun::before,
#sun::after {
  content: "";
  position: absolute;
  inset: -40px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255, 250, 230, 0.32) 0%, rgba(255, 250, 230, 0.1) 45%, rgba(255, 250, 230, 0) 70%);
  opacity: 0.7;
}

#sun::after {
  inset: -95px;
  background: radial-gradient(circle, rgba(255, 246, 210, 0.22) 0%, rgba(255, 246, 210, 0.07) 40%, rgba(255, 246, 210, 0) 70%);
  opacity: 0.5;
}

@keyframes sunArc {
  0%   { transform: translate(-10vw, 6vh); }
  50%  { transform: translate(50vw, -6vh); }
  100% { transform: translate(110vw, 8vh); }
}

#cloud-layer {
  position: absolute;
  inset: 0;
  min-height: var(--doc-h);
  z-index: -2;
  pointer-events: none;
}

.cloud {
  position: absolute;
  background: rgba(255, 255, 255, 0.85);
  border-radius: 999px;
  filter: blur(0.5px);
  box-shadow: -20px 10px 0 rgba(255, 255, 255, 0.8),
              25px 8px 0 rgba(255, 255, 255, 0.75);
  animation: cloudDrift linear infinite;
}

@keyframes cloudDrift {
  from { transform: translateX(-20vw); }
  to   { transform: translateX(120vw); }
}

#flare-group {
  position: absolute;
  inset: 0;
  z-index: -2;
  pointer-events: none;
}

#flare-line {
  position: absolute;
  height: 2px;
  background: rgba(255, 255, 255, 0.35);
  opacity: 0;
  /* Debug hint: set opacity to 0.35 to reveal the flare alignment line. */
  transform-origin: 0 50%;
}

.flare-streak {
  position: absolute;
  height: 6px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(255, 255, 255, 0) 0%, rgba(255, 245, 220, 0.45) 45%, rgba(255, 255, 255, 0) 100%);
  mix-blend-mode: screen;
  filter: blur(1px);
  opacity: 0.35;
  transform-origin: 0 50%;
}

.flare-orb {
  position: absolute;
  border-radius: 50%;
  mix-blend-mode: screen;
  background: radial-gradient(circle at 35% 35%, hsla(var(--flare-hue), 95%, 92%, calc(var(--flare-alpha) + 0.2)) 0%, hsla(var(--flare-hue), 85%, 75%, var(--flare-alpha)) 45%, hsla(var(--flare-hue), 85%, 60%, 0) 72%);
  filter: blur(0.4px);
  box-shadow: 0 0 18px rgba(255, 255, 255, 0.25);
}
</style>

<script>
function setDocHeight() {
  const full = document.documentElement.scrollHeight;
  document.documentElement.style.setProperty('--doc-h', full + 'px');
}
window.addEventListener('load',  setDocHeight);
window.addEventListener('resize', setDocHeight);

function buildSkyScene() {
  const sky = document.createElement('div');
  sky.id = 'sky-layer';

  const cloudLayer = document.createElement('div');
  cloudLayer.id = 'cloud-layer';

  const sunGroup = document.createElement('div');
  sunGroup.id = 'sun-group';

  const sun = document.createElement('div');
  sun.id = 'sun';

  const flareGroup = document.createElement('div');
  flareGroup.id = 'flare-group';

  const flareLine = document.createElement('div');
  flareLine.id = 'flare-line';

  const flareStreak = document.createElement('div');
  flareStreak.className = 'flare-streak';

  sunGroup.appendChild(sun);
  flareGroup.appendChild(flareLine);
  flareGroup.appendChild(flareStreak);

  document.body.prepend(cloudLayer);
  document.body.prepend(flareGroup);
  document.body.prepend(sunGroup);
  document.body.prepend(sky);

  const sunSize = 100;
  const arcDuration = 60000;
  const flareCycle = 7000;

  const flareSpecs = [
    { distance: 0.2, size: 16, hue: 42, opacity: 0.28, phase: 0.0 },
    { distance: 0.38, size: 20, hue: 70, opacity: 0.22, phase: 1.1 },
    { distance: 0.56, size: 26, hue: 195, opacity: 0.2, phase: 2.4 },
    { distance: 0.78, size: 34, hue: 310, opacity: 0.17, phase: 3.1 },
    { distance: 1.05, size: 46, hue: 24, opacity: 0.12, phase: 4.0 }
  ];

  const flareOrbs = flareSpecs.map((spec) => {
    const orb = document.createElement('div');
    orb.className = 'flare-orb';
    orb.style.width = `${spec.size}px`;
    orb.style.height = `${spec.size}px`;
    orb.style.setProperty('--flare-hue', spec.hue);
    orb.style.setProperty('--flare-alpha', spec.opacity);
    flareGroup.appendChild(orb);
    return orb;
  });

  function animateSun(timestamp) {
    if (!animateSun.start) animateSun.start = timestamp;
    const elapsed = (timestamp - animateSun.start) % arcDuration;
    const progress = elapsed / arcDuration;

    const viewportW = window.innerWidth;
    const viewportH = window.innerHeight;

    const x = (-0.1 + 1.2 * progress) * viewportW;
    const arcHeight = 0.2 * viewportH;
    const baseHeight = 0.14 * viewportH;
    const y = baseHeight - arcHeight * Math.sin(Math.PI * progress);

    sunGroup.style.transform = `translate(${x}px, ${y}px)`;

    const sunCenterX = x - sunSize / 1.9;
    const sunCenterY = y + sunSize*1.4;
    const centerX = viewportW * 0.52;
    const centerY = viewportH * 0.58;
    const dx = centerX - sunCenterX;
    const dy = centerY - sunCenterY;
    const lineLength = Math.hypot(dx, dy);
    const lineAngle = Math.atan2(dy, dx);

    flareLine.style.width = `${lineLength}px`;
    flareLine.style.transform = `translate(${sunCenterX}px, ${sunCenterY}px) rotate(${lineAngle}rad)`;

    const flarePhase = ((timestamp - animateSun.start) % flareCycle) / flareCycle;
    const pulse = flarePhase * Math.PI * 2;
    const streakOffset = lineLength * 0.18;
    const streakLength = lineLength * 0.6;

    flareOrbs.forEach((orb, index) => {
      const spec = flareSpecs[index];
      const offset = Math.sin(pulse + spec.phase);
      const drift = spec.distance + offset * 0.04;
      const size = spec.size * (1 + 0.12 * Math.cos(pulse + spec.phase));
      const alpha = Math.min(0.6, Math.max(0.05, spec.opacity + 0.12 * offset));

      const orbX = sunCenterX + dx * drift - size / 2;
      const orbY = sunCenterY + dy * drift - size / 2;

      orb.style.transform = `translate(${orbX}px, ${orbY}px)`;
      orb.style.width = `${size}px`;
      orb.style.height = `${size}px`;
      orb.style.setProperty('--flare-alpha', alpha.toFixed(3));
      orb.style.boxShadow = `0 0 ${size * 1.4}px hsla(${spec.hue}, 90%, 80%, ${alpha * 0.6})`;
    });

    const streakPulse = 0.3 + 0.18 * Math.sin(pulse + 0.4);
    flareStreak.style.width = `${streakLength}px`;
    flareStreak.style.transform = `translate(${sunCenterX}px, ${sunCenterY}px) rotate(${lineAngle}rad) translateX(${streakOffset}px)`;
    flareStreak.style.opacity = `${streakPulse.toFixed(2)}`;

    requestAnimationFrame(animateSun);
  }

  requestAnimationFrame(animateSun);

  const NUM_CLOUDS = 10;
  for (let i = 0; i < NUM_CLOUDS; i++) {
    const cloud = document.createElement('div');
    cloud.className = 'cloud';

    const size = 70 + Math.random() * 150;
    cloud.style.width = size + 'px';
    cloud.style.height = size * 0.35 + 'px';
    const verticalBands = [6, 18, 28, 36, 42];
    const topBase = verticalBands[Math.floor(Math.random() * verticalBands.length)];
    cloud.style.top = (topBase + Math.random() * 8) + 'vh';
    cloud.style.left = (-40 + Math.random() * 120) + 'vw';

    const duration = (48 + Math.random() * 40).toFixed(2) + 's';
    cloud.style.animationDuration = duration;
    cloud.style.opacity = (0.5 + Math.random() * 0.35).toFixed(2);
    cloud.style.animationDelay = (-Math.random() * 30).toFixed(2) + 's';

    cloudLayer.appendChild(cloud);
  }
}
window.addEventListener('load', buildSkyScene);

</script>
